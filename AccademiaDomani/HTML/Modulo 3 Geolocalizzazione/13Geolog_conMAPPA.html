<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<script src="http://maps.google.com/maps/api/js?sensor=false"> //siccome il dispositivo non è dotato di GPS si mette false, ma pure con true senza GPS funziona, in questo caso si basa sull'indirizzo IP</script>
<body>
    <h1>Geolocalizzazione</h1>
    <p>
        
        Parlando di "html5" geolocalizzazione: la prima cosa che bisogna sottolineare è il suppporto consistente dovuto dai vari brownse. <br>
        ogni browser ha un suo serivizio: <br> 
        Google: Google location Service <br>
        Firefx: stessi serivizi, ma no su linux <br>
        Edge: Microsofr locations Service <br>
        Safari: apple locations Service <br>
        Opera: google locations Service <br>

        problemi tecnici: un  proxY del provider. <br>
        per cui alcuni browser non c'è possibilità di geolocalizzazione: per carenza di alcuni servizi. <br>
        C'è un servizio ottimale dei browser stessi <br>
    </p>
    <H3>Esercizio</H3>
    <p id="dati">
        Ti trovi QUI: <br>
        Latitudine: <span id="latitudine"></span> <br>
        Longitudine: <span id="longitudine"></span> <br>
    </p>
    <button onclick="richiediPosizione()">Localizzami</button>
    <div id="mappa" style="height: 500px;"></div>

   

    <script>
        //se il browser funziona la funzione riceve un paramentro "posizione"
        //position oggetto, che a sua volta contiene ifnormazione di dettaglio, sto dicendo di andare nel dettaglio:
        function successo(posizione)
        {
            document.getElementById('latitudine').innerHTML= posizione.coords.latitude;
            document.getElementById('longitudine').innerHTML = posizione.coords.longitude;
        
        //la finestra informativa (InfoWindow)
        var infoWindow = new google.maps.InfoWindow();
        var opzioniMappa = {zoom: 12, mapTypeId: google.maps.MapTypeId.ROADMAP}; //operazione JSON //ROADMAP o SATELLITE
        var mappa = new google.maps.Map(document.getElementById("mappa"), opzioniMappa);//collegamento con il DIV nel quale uscirà la mappa
        //oggetto mapppa ora creato

        //ora bisogna preparare un oggetto che va fornito come parametro al metodo 
        //si fa riferimento al metodo LatLng

        initialLocation = new google.maps.LatLng(posizione.coords.latitude, posizione.coords.longitude); //posizione.coords.latitude/longitude metodo che viene utilizzato per i dat

        //visualizzazione mappa centrata secondo long e latid
        mappa.setCenter(initialLocation);
            infoWindow.setContent(posizione.coords.latitude+ " " + posizione.coords.longitude); //assegniamo il contenuto come messaggio
            infoWindow.setPosition (initialLocation);
            infoWindow.open(mappa); //pop up
        }


        //funzione in caso di errore
        function errore (error){
            switch (error.code)
            {
                case 1: alert("Non hai i privilegi per usare la geolocalizzazione"); //l'utente che usa lo smartphone ha negato dalle impostazioni la geoloc.
                break;

                case 2: alert("Servizio non disponibile") //problemi con centralina, scheda adsl etc (errori tecnici)
                break;

                case 3: alert("Tempo scaduto") //tutto di per se funziona, ma c'è qualcosa che rallenta il tutto oltre che il tempo che il programmatore ha accettato prima di ricadere nella gestione dell'errore
                break;
            }
        }
//la funzione cerca di capire se il browser cerca di capire se il browser riesce a localizzare il dispositivo
        function richiediPosizione(){
            if (navigator.geolocation)
            //se funziona si cercano le coordinate:
            navigator.geolocation.getCurrentPosition(successo, errore, {timeout:2000, enableHighAccuracy:true, maxinumAge:2000}); //successo ed errore sono due funzioni: meccanismo di callback. (con "enableHighAccuracy"si aumenta la precisione, con "maxinumAge" si mette una pausa tra una verifica e la prossima richeista dall'utente) 
            else
            document.getElementById('dati').innerHTML ="Geolocalizazione non supportata da questo browser.";
        }

    </script>
</body>
</html>
